import{r as m,j as e,L as U,i as S}from"./index-CAaY5v6k.js";import{j as L,g as k}from"./axios-Dxvmi79v.js";const D="_userProfileContainer_12uxg_3",H="_profileCard_12uxg_47",F="_profileHeader_12uxg_65",T="_headerInner_12uxg_81",M="_headerActions_12uxg_119",z="_roleBadge_12uxg_131",G="_logoutButton_12uxg_163",O="_userDetails_12uxg_221",$="_bodyInner_12uxg_233",R="_detailsSection_12uxg_251",J="_detailItem_12uxg_285",Z="_label_12uxg_335",q="_value_12uxg_349",K="_inlineHint_12uxg_363",Q="_subjectGrid_12uxg_377",V="_subjectCard_12uxg_389",W="_subjectBadge_12uxg_417",X="_subjectTitle_12uxg_439",Y="_errorMessage_12uxg_455",ee="_retryButton_12uxg_481",s={userProfileContainer:D,profileCard:H,profileHeader:F,headerInner:T,headerActions:M,roleBadge:z,logoutButton:G,userDetails:O,bodyInner:$,detailsSection:R,detailItem:J,label:Z,value:q,inlineHint:K,subjectGrid:Q,subjectCard:V,subjectBadge:W,subjectTitle:X,errorMessage:Y,retryButton:ee},se=r=>{if(!Array.isArray(r))return[];const j=r.map(a=>{if(!a)return null;if(typeof a=="object"){const t=String(a.code||a.subjectCode||a.id||"").toUpperCase(),d=String(a.name||a.title||a.subjectName||"").trim();return t||d?{code:t,name:d}:null}if(typeof a=="string"){const t=a.trim(),d=t.match(/^([A-Za-z]{2,}\d{2,})(?:[\s:-]+(.+))?$/);if(d){const N=d[1].toUpperCase(),x=(d[2]||"").trim();return{code:N,name:x}}return{code:"",name:t}}return null}).filter(Boolean),o=new Map,h=new Map;j.forEach(a=>{if(a.code){const t=o.get(a.code);t?!t.name&&a.name&&o.set(a.code,a):o.set(a.code,a)}else if(a.name){const t=a.name.toLowerCase();h.has(t)||h.set(t,a)}});const p=[...o.values(),...h.values()];return p.sort((a,t)=>(a.code||"").localeCompare(t.code||"")||(a.name||"").localeCompare(t.name||"")),p},re=()=>{const[r,j]=m.useState(null),[o,h]=m.useState(""),[p,a]=m.useState(!0),[t,d]=m.useState([]),[N,x]=m.useState(!1),[C,A]=m.useState(""),I=async()=>{console.log("Logging out..."),S.remove("admin"),S.remove("attendanceToken"),S.remove("role"),window.location.reload()};m.useEffect(()=>{(async()=>{try{a(!0);const c=await k();if(c.status!==200){alert("Some error occur"),window.location.reload();return}const n=c.data?.user;if(n.role||(n.role="student"),!n)throw new Error("Invalid user data");switch(n.role){case"admin":j({_id:n._id,email:n.email,center:n.center,phone:n.phone,boss:n.boss||null}),h("admin");break;case"student":j({_id:n._id,id:n.id,name:n.name,course:n.course,subjects:n.subjects,boss:n.boss||null,center:n.center||null}),h("student");break;case"teacher":j({_id:n._id,id:n.id,name:n.name,subjects:n.subjects,boss:n.boss||null,center:n.center||null}),h("teacher");break;default:throw new Error("Unknown user type")}}catch(c){console.error(c),A("Failed to load user data")}finally{a(!1)}})()},[]),m.useEffect(()=>{if(!r)return;const i=se(r.subjects);d(i);const c=Array.from(new Set(i.filter(u=>u&&u.code&&!u.name).map(u=>u.code))),n=o==="admin"?r?._id:"68caa23ae2a5edb15b4ba51c";if(!c.length||!n){x(!1);return}let b=!1;return x(!0),L(n,JSON.stringify(c)).then(u=>{if(b)return;const f=u?.data,E=Array.isArray(f)?f:Array.isArray(f?.subjects)?f.subjects:[],v=new Map;E.forEach(g=>{const y=String(g.code||"").toUpperCase(),l=String(g.name||g.title||"").trim();y&&l&&v.set(y,l)}),d(g=>g.map(l=>l.code&&!l.name&&v.has(l.code)?{...l,name:v.get(l.code)}:l).slice().sort((l,w)=>(l.code||"").localeCompare(w.code||"")||(l.name||"").localeCompare(w.name||"")))}).catch(u=>{console.error("Failed to fetch subjects via getSubjects:",u)}).finally(()=>{b||x(!1)}),()=>{b=!0}},[r,o]);const B=()=>!t||t.length===0?"—":e.jsxs(e.Fragment,{children:[N&&e.jsx("div",{className:s.inlineHint,children:"Loading subject names…"}),e.jsx("div",{className:s.subjectGrid,children:t.map((i,c)=>e.jsxs("div",{className:s.subjectCard,children:[e.jsx("span",{className:s.subjectBadge,children:i.code||"—"}),e.jsx("div",{className:s.subjectTitle,children:i.name||"—"})]},`${i.code}-${i.name}-${c}`))})]}),_=()=>{const i=r?.center||r?.boss?.center||"—",c=r?.boss?.email||"—",n=r?.boss?.phone||"—",b=!!r?.boss;return e.jsxs("div",{className:s.detailsSection,children:[e.jsx("h2",{children:"Organization"}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.label,children:"Center"}),e.jsx("span",{className:s.value,children:i})]}),b&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.label,children:"Boss Email"}),e.jsx("span",{className:s.value,children:c})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.label,children:"Boss Phone"}),e.jsx("span",{className:s.value,children:n})]})]})]})},P=()=>{if(!r)return null;switch(o){case"admin":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:s.detailsSection,children:[e.jsx("h2",{children:"Admin Profile"}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.label,children:"Email"}),e.jsx("span",{className:s.value,children:r.email||"—"})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.label,children:"Center"}),e.jsx("span",{className:s.value,children:r.center||"—"})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.label,children:"Phone"}),e.jsx("span",{className:s.value,children:r.phone||"—"})]})]}),_()]});case"student":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:s.detailsSection,children:[e.jsx("h2",{children:"Student Profile"}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.label,children:"ID"}),e.jsx("span",{className:s.value,children:r.id||"—"})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.label,children:"Name"}),e.jsx("span",{className:s.value,children:r.name||"—"})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.label,children:"Course"}),e.jsx("span",{className:s.value,children:r.course||"—"})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.label,children:"Subjects"}),e.jsx("div",{className:s.value,children:B()})]})]}),_()]});case"teacher":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:s.detailsSection,children:[e.jsx("h2",{children:"Teacher Profile"}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.label,children:"ID"}),e.jsx("span",{className:s.value,children:r.id||"—"})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.label,children:"Name"}),e.jsx("span",{className:s.value,children:r.name||"—"})]}),e.jsxs("div",{className:s.detailItem,children:[e.jsx("span",{className:s.label,children:"Subjects"}),e.jsx("div",{className:s.value,children:B()})]})]}),_()]});default:return e.jsx("div",{children:"Unknown user role"})}};return p?e.jsx(U,{}):C?e.jsx("div",{className:s.userProfileContainer,children:e.jsxs("div",{className:s.profileCard,children:[e.jsx("header",{className:s.profileHeader,children:e.jsxs("div",{className:s.headerInner,children:[e.jsx("h1",{children:"User Profile"}),e.jsxs("div",{className:s.headerActions,children:[e.jsx("div",{className:s.roleBadge,children:"Error"}),e.jsx("button",{type:"button",className:s.logoutButton,onClick:I,children:"Logout"})]})]})}),e.jsxs("div",{className:s.errorMessage,children:[e.jsx("h3",{children:"Something went wrong"}),e.jsx("p",{children:C}),e.jsx("button",{className:s.retryButton,onClick:()=>window.location.reload(),children:"Try Again"})]})]})}):e.jsx("div",{className:s.userProfileContainer,children:e.jsxs("div",{className:s.profileCard,children:[e.jsx("header",{className:s.profileHeader,children:e.jsxs("div",{className:s.headerInner,children:[e.jsx("h1",{children:"User Profile"}),e.jsxs("div",{className:s.headerActions,children:[e.jsx("div",{className:s.roleBadge,children:o}),e.jsx("button",{type:"button",className:s.logoutButton,onClick:I,children:"Logout"})]})]})}),e.jsx("section",{className:s.userDetails,children:e.jsx("div",{className:s.bodyInner,children:P()})})]})})};export{re as default};
